<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: {
          equationNumbers: { autoNumber: "AMS" },
          extensions: ["color.js"]
        }
      })
    </script>
    <style>
      body {
        background: #F5F5DC;
      }

      .document {
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }
    </style>
  </head>
  <body>
    <div class="document">
      \(
        \require{cancel}
        \newcommand{\d}[2]{\frac{d #1}{d #2}}
        \newcommand{\dt}[1]{\d{#1}{t}}
        \newcommand{\pd}[2]{\frac{\partial #1}{\partial #2}}
        \newcommand{\pdt}[1]{\pd{#1}{t}}
        \newcommand{\hdiv}{\nabla_{\pi} \cdot \mathbf{V}}
        \newcommand{\cpocv}{\frac{C_p}{C_V}}
        \newcommand{\cvocp}{\frac{C_V}{C_p}}
      \)

      <h1>静力气压坐标</h1>
      <p>
        采用基于静力气压或质量坐标的预报方程组（Laprise 1992）
        \[
          \begin{align}
            \dt{\mathbf{V}} & = - \frac{1}{\rho} \nabla_\pi p - \pd{p}{\pi} \nabla_\pi \phi + \mathbf{F} \\
            {\color{red}\gamma \dt{w}} & {\color{red}= g \left( \pd{p}{\pi} - 1 \right) + \gamma F_z} \\
            \dt{\theta} & = \frac{Q}{C_p} \frac{\theta}{T} \\
            \pdt{\pi_s} & = - \int_{\pi_t}^{\pi_s} \nabla_\pi \cdot \mathbf{V} d \pi \\
            {\color{red}\dt{\phi}} & {\color{red}= w g} \text{或} {\color{blue}w = \frac{1}{g} \dt{\phi}}
          \end{align}
        \]
        若干诊断方程
        <ul>
          <li>
            连续方程（计算静力气压垂直速度\(\dot{\pi}\)）
            \[
              \hdiv + \pd{\dot{\pi}}{\pi} = 0 \to \dot{\pi} = - \int_{\pi_t}^{\pi} \hdiv d \pi
            \]
          </li>
          <li>
            静力方程（非静力模式计算密度\(\rho\)，静力模式计算位势\(\phi\)）
            \[
              {\color{red}\rho = - \left( \pd{\phi}{\pi} \right)^{-1}} \text{或} {\color{blue}\pd{\phi}{\pi} = - \frac{1}{\rho}}
            \]
          </li>
          <li>
            代入位温定义式的状态方程（非静力模式计算气压，静力模式计算密度）
            \[
              {\color{red}p = p_0 \left( \frac{\rho R \theta}{p_0} \right)^{\cpocv}} \text{或} {\color{blue}\rho = \frac{p_0}{R \theta} \left( \frac{p}{p_0} \right)^{\cvocp}}
            \]
          </li>
        </ul>
        若干定义式
        <ul>
          <li>
            时间全导数
            \[
              \dt{} = \hdiv + \dot{\pi} \pd{}{\pi}
            \]
          </li>
          <li>
            三维散度
            \[
              D_3 = \hdiv + \rho \nabla_{\pi} \phi \cdot \pd{\mathbf{V}}{\pi} - \rho g \pd{w}{\pi}
            \]
          </li>
        </ul>
      </p>
      <h1>广义地形跟随坐标</h1>
      <p>
        引入一个关于静力气压坐标\(\pi\)的单调函数\(\eta \left( \pi, \pi_s \right)\)，满足如下地形追随条件：
        <ul>
          <li>
            模式底是坐标面1：\(\eta \left( \pi_s, \pi_s \right) = 1\)
          </li>
          <li>
            模式顶是坐标面0：\(\eta \left( \pi_t, \pi_s \right) = 0\)
          </li>
          <li>
            上下边界的垂直坐标速度为零：\(\dot{\eta} \left( \pi_s, \pi_s \right) = \dot{\eta} \left( \pi_t, \pi_s \right) = 0\)
          </li>
        </ul>
        坐标转换式
        \[
          \begin{align}
            \left( \pd{F}{t} \right)_\pi & = \left( \pd{F}{t} \right)_\eta - \pd{\eta}{\pi} \left( \pdt{\pi} \right)_\eta \pd{F}{\eta} \\
            \nabla_\pi F & = \nabla_\eta F - \pd{\eta}{\pi} \nabla_\eta \pi \pd{F}{\eta}
          \end{align}
        \]
      </p>
      <p>
        <ul>
          <li>
            连续方程
            \[
              \begin{equation}
                \pd{}{\eta} \pdt{\pi} + \nabla_{\eta} \cdot \left( \mathbf{V} \pd{\pi}{\eta} \right) + \pd{}{\eta} \left( \dot{\eta} \pd{\pi}{\eta} \right) = 0
                \label{eq:eta-continuity-equation}
              \end{equation}
            \]
          </li>
          <li>
            静力方程
            \[
              \begin{equation}
                \pd{\phi}{\eta} = - \frac{1}{\rho} \pd{\pi}{\eta}
                \label{eq:eta-hydrostatic-equation}
              \end{equation}
            \]
          </li>
          <li>
            动量方程
            \[
              \frac{1}{\rho} \nabla_\pi p = \frac{1}{\rho} \nabla_\eta p - \cancel{\frac{1}{\rho} \pd{\eta}{\pi} \pd{p}{\eta} \nabla_\eta \pi}
            \]
            \[
              \begin{align*}
                \pd{p}{\pi} \nabla_{\pi} \phi & = \pd{p}{\pi} \nabla_{\eta} \phi - \pd{p}{\pi} \pd{\eta}{\pi} \pd{\phi}{\eta} \nabla_\eta \pi \\
                                              & = \pd{p}{\pi} \nabla_{\eta} \phi + \pd{p}{\pi} \pd{\eta}{\pi} \frac{1}{\rho} \pd{\pi}{\eta} \nabla_\eta \pi \quad\leftarrow\text{代入静力方程\eqref{eq:eta-hydrostatic-equation}} \\
                                              & = \pd{p}{\pi} \nabla_{\eta} \phi + \cancel{\pd{p}{\pi} \frac{1}{\rho} \nabla_\eta \pi}
              \end{align*}
            \]
            上面两式中的第二项相消，因此动量方程形式上仅变换水平梯度算子的下标
            \[
              \begin{equation}
                \dt{\mathbf{V}} = - \frac{1}{\rho} \nabla_{\eta} p - \pd{p}{\pi} \nabla_{\eta} \phi + \mathbf{F}
              \end{equation}
            \]
          </li>
          <li>
            地面静力气压方程
            对\eqref{eq:eta-continuity-equation}两侧做\(\eta\)从\(0\)到\(1\)的积分，其中应用了在上下边界上\(\dot{\eta} = 0\)的条件
            \[
              \pdt{\pi_s} = - \int_0^1 \nabla_\eta \cdot \left( \mathbf{V} \pd{\pi}{\eta} \right) d \eta
            \]
          </li>
        </ul>
      </p>
      <p>
        广义地形追随坐标系下的预报方程组为
        \[
          \begin{align}
            \dt{\mathbf{V}} & = - \frac{1}{\rho} \nabla_{\eta} p - \pd{p}{\eta} \pd{\eta}{\pi} \nabla_{\eta} \phi + \mathbf{F} \\
            {\color{red}\gamma \dt{w}} & {\color{red}= g \left( \pd{p}{\eta} \pd{\eta}{\pi} - 1 \right) + \gamma F_z} \\
            \dt{\theta} & = \frac{Q}{C_p} \frac{\theta}{T} \\
            \pdt{\pi_s} & = - \int_0^1 \nabla_\eta \cdot \left( \mathbf{V} \pd{\pi}{\eta} \right) d \eta \\
            {\color{red}\dt{\phi}} & {\color{red}= w g} \text{或} {\color{blue}w = \frac{1}{g} \dt{\phi}}
          \end{align}
        \]
        诊断方程为
        \[
          \begin{align}
            \pd{}{\eta} \pdt{\pi} + \nabla_{\eta} \cdot \left( \mathbf{V} \pd{\pi}{\eta} \right) + \pd{}{\eta} \left( \dot{\eta} \pd{\pi}{\eta} \right) & = 0 \to 
            \dot{\eta} \pd{\pi}{\eta} = - \pdt{\pi} - \int_0^\eta \nabla_{\eta} \cdot \left( \mathbf{V} \pd{\pi}{\eta} \right) d \eta \\
            {\color{red}\rho = - \pd{\pi}{\eta} \left( \pd{\phi}{\eta} \right)^{-1}} & \text{或} {\color{blue}\pd{\phi}{\eta} = - \frac{1}{\rho} \pd{\pi}{\eta}} \\
            {\color{red}p = p_0 \left( \frac{\rho R \theta}{p_0} \right)^{\cpocv}} & \text{或} {\color{blue}\rho = \frac{p_0}{R \theta} \left( \frac{p}{p_0} \right)^{\cvocp}}
          \end{align}
        \]
        其中\(\pd{p}{\eta}\)和\(\pd{\pi}{\eta}\)来自于坐标定义，红色项是非静力模式需要计算的项，蓝色为静力模式。
      </p>
      <h2>几种特定形式</h2>
      <h3>混合坐标</h3>
      <p>
        \[
          \begin{equation}
            \pi( x, y, \eta, t) = A(\eta) + B(\eta) \pi_s(x, y, t)
            \label{eq:hybrid-coordinate}
          \end{equation}
        \]
        其中函数\(A(\eta)\)和\(B(\eta)\)满足如下条件：1）\(A(1) = 0, B(1) = 1\)；2）\(A(0) = \pi_t, B(0) = 0\)。对\eqref{eq:hybrid-coordinate}做时间、\(\eta\)和水平坐标的导数得到
        \[
          \pdt{\pi} = B \pdt{\pi_s}
        \]
        \[
          \pd{\pi}{\eta} = \d{A}{\eta} + \pi_s \d{B}{\eta}
        \]
        \[
          \nabla_\eta \pi = B \nabla_\eta \pi_s = B \pi_s \nabla_\eta \ln \pi_s
        \]
      </p>
    </div>
  </body>
</html>
